USE KODILLA_COURSE;

CREATE TABLE ISSUESLIST
(
    ID   SERIAL PRIMARY KEY,
    NAME VARCHAR(100)
);

COMMIT;

CREATE TABLE ISSUES
(
    ID                 SERIAL PRIMARY KEY,
    ISSUESLISTS_ID     BIGINT UNSIGNED NOT NULL,
    SUMMARY            VARCHAR(200),
    DESCRIPTION        VARCHAR(500),
    USER_ID_ASSIGNEDTO BIGINT UNSIGNED NOT NULL
);

COMMIT;

ALTER TABLE ISSUES
    ADD CONSTRAINT ISSUES_LISTS_ID
        FOREIGN KEY (ISSUESLISTS_ID) REFERENCES ISSUESLIST (ID);

COMMIT;

ALTER TABLE ISSUES
    ADD CONSTRAINT USER_ID_ASSIGNED_TO
        FOREIGN KEY (USER_ID_ASSIGNEDTO) REFERENCES USERS (ID);

COMMIT;

SELECT *
FROM ISSUESLIST;

INSERT INTO ISSUESLIST (NAME)
VALUES ('ToDo'),
       ('In progress'),
       ('Done');

COMMIT;

SELECT *
FROM ISSUESLIST;

SELECT *
FROM ISSUES;

SELECT *
FROM USERS;

INSERT INTO ISSUES (ISSUESLISTS_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
    VALUE (1, 'To do one...', 'Description one...', 1),
    (1, 'To do two...', 'Description two...', 1),
    (2, 'In progress one...', 'Description three...', 2),
    (2, 'In progress two...', 'Description four...', 3),
    (3, 'Done...', 'Description five...', 4);

SELECT *
FROM ISSUES;

COMMIT;

SELECT USERS.LASTNAME, USERS.FIRSTNAME, ISSUES.DESCRIPTION FROM ISSUES
INNER JOIN USERS ON ISSUES.USER_ID_ASSIGNEDTO = USERS.ID
ORDER BY LASTNAME;
